<!DOCTYPE html>
<html>
<head>
    <title>Use Dynamic Web TWAIN to Negotiate TWAIN Capabilities</title>
    <script type="text/javascript" src="Resources/dynamsoft.webtwain.initiate.js"> </script>
    <script type="text/javascript" src="Resources/dynamsoft.webtwain.config.js"> </script>
	<script type="text/javascript" src="cn.js"> </script>
</head>

<body style = 'font-family: "verdana", "sans-serif";font-size: 11px;'>
	<div style="float:left; width:352px;">
		<div id="dwtcontrolContainer"></div>
	</div>
	<div style="float:left; width:272px; height:352px;">
		Choose A Scanner: <select size="1" id="source" style="width: 160px; margin-Bottom:10px;"></select><br />
		<input type="button" value="Show Supported Capabilites" style="width: 270px; margin-top:10px;" onclick="checkScanner();" /><br />
		Supported Capabilities: <select size="1" id="capabilities" style="width: 135px; margin-top:10px;" onchange="getCapabilityInfo();"></select><br />
		Message Type: <select size="1" id="messageType" style="width: 182px; margin-top:10px;" onchange="changePageStyle();"></select><br />
		Container Type: <select size="1" id="containerType" style="width: 177px; margin-top:10px;" disabled="disabled"></select><br />
		<span id="availableValuesSPAN" style="display:none" >Available Values: <select size="1" id="availableValues" style="width: 170px; margin-top:10px;"></select></span><br /><br />
		<span id='textAboveInput'>Returned:</span><br />
		<select size="1" id="TrueOrFalse" style="width: 268px; margin-top:5px; display:none;">
			<option value="1">TRUE</option>
			<option value="0">False</option>
		</select>
		<input id="txtReturnedOrToSet"  type="text" value="" style="width: 268px; margin-top:5px;" /><br />
		<input type="button" id="btnSetCapability" value="Start Negotiation" style="width: 270px; margin:10px 0; display:none;" onclick="setCapability();" /><br />
		<input type="button" id="btnScanEx" value="Start Scanning" style="width: 270px; margin:10px 0;" onclick="btnScanEx();" /><br />
		<span id='textAboveArea'>Structure: </span><input type="button" value="Clear All" onclick="clearInfo();" /><br />
		<div id="status_text" style="height:134px; overflow-y:scroll; border: solid 1px silver"></div>
	<div>
	

    <script type="text/javascript">
        var DWObject;
		var textStatus = "";
		var supportedCapabilities, msgType, ctnType, txtReturnedOrToSet;
        Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady); 
		
        function Dynamsoft_OnReady() {
			/*if(document.location.protocol == "file:") {
				alert("Please deploy this page on a web server (like IIS("Apache("etc.) before testing it("opening it directly as a file won't work.");
				return;
			}*/
			/* 
			* Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'
			*/
            DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); 
			supportedCapabilities = document.getElementById("capabilities");
            if (DWObject) {
				msgType = document.getElementById("messageType");
                msgType.options.add(new Option("MSG_GET", EnumDWT_TWAINMSGTYPE.MSG_GET));
				msgType.options.add(new Option("MSG_GETCURRENT", EnumDWT_TWAINMSGTYPE.MSG_GETCURRENT));
				msgType.options.add(new Option("MSG_GETDEFAULT", EnumDWT_TWAINMSGTYPE.MSG_GETDEFAULT));
				msgType.options.add(new Option("MSG_GETFIRST", EnumDWT_TWAINMSGTYPE.MSG_GETFIRST));
				msgType.options.add(new Option("MSG_GETNEXT", EnumDWT_TWAINMSGTYPE.MSG_GETNEXT));
				msgType.options.add(new Option("MSG_SET", EnumDWT_TWAINMSGTYPE.MSG_SET));
				msgType.options.add(new Option("MSG_RESET", EnumDWT_TWAINMSGTYPE.MSG_RESET));
				msgType.options.add(new Option("MSG_QUERYSUPPORT", EnumDWT_TWAINMSGTYPE.MSG_QUERYSUPPORT));
				
				ctnType = document.getElementById("containerType");
                ctnType.options.add(new Option("TWON_ARRAY", EnumDWT_TWAINCONTAINERTYPE.TWON_ARRAY));
				ctnType.options.add(new Option("TWON_ENUMERATION", EnumDWT_TWAINCONTAINERTYPE.TWON_ENUMERATION));
				ctnType.options.add(new Option("TWON_ONEVALUE", EnumDWT_TWAINCONTAINERTYPE.TWON_ONEVALUE));
				ctnType.options.add(new Option("TWON_RANGE", EnumDWT_TWAINCONTAINERTYPE.TWON_RANGE));
				txtReturnedOrToSet = document.getElementById('txtReturnedOrToSet');
				TrueOrFalse = document.getElementById('TrueOrFalse');
				/*
				* List all available TWAIN deivces (scanners("etc.)
				*/				
				var twainsource = document.getElementById("source");
				twainsource.options.length = 0;
				var vCount = DWObject.SourceCount
                for (var i = 0; i < vCount; i++) {
                    twainsource.options.add(new Option(DWObject.GetSourceNameItems(i), i));
                }
				DWObject.SetViewMode(2,2);
			}
        }
		
        function AcquireImage() {
            if (DWObject) {
                DWObject.SelectSourceByIndex(document.getElementById("source").selectedIndex);
                DWObject.OpenSource();
                DWObject.IfDisableSourceAfterAcquire = true;	// Scanner source will be disabled/closed automatically after the scan.
                DWObject.IfFeederEnabled = true;
				DWObject.IfShowUI = false;
                DWObject.AcquireImage();
            }
        }
		
		function clearInfo(){
			document.getElementById('status_text').innerHTML = "";
			textStatus = "";
		}
		
		function UpdateInfo(txt, specialtxt){
			if(specialtxt){
				textStatus += '<span style="color:#cE5E04"><strong>' + txt + '</strong></span><br /><br />';
			}
			else{
				textStatus +=  txt + "<br /><br />";			
			}
			document.getElementById('status_text').innerHTML = textStatus;
		}
    </script>
</body>
</html>
